---
import { marked } from 'marked';

// Configure marked for better list handling
marked.setOptions({
  gfm: true,
  breaks: false
});

const projects = [
  {
    title: "rifftales",
    images: [
      "/assets/img/guitar-db.png",
      "/assets/img/guitar-db2.png"
    ],
    site: "https://www.rifftales.net",
    description: `One of my hobbies is guitar playing, and I enjoy window shopping for my next guitar. This **full-stack app** is my take on building an enjoyable place for musicians to upload, browse, and show off their musical equipment.<br><br>

The app has a **strong social layer**: users can like, comment, and discuss each other's gear, helping build a community of musicians and gear enthusiasts who love sharing their setups and getting inspiration from others.<br><br>

**Technical details:**<br>

• Backend: Node.js + Express with Mongoose and MongoDB<br>
• Authentication: Custom passwordless login (magic links) for the smoothest possible user experience<br>
• Frontend: React with Context API for global state management and Tailwind CSS for fast, responsive styling<br><br>
It's a passion project that combines my love for guitars with full-stack development, focused on speed, usability, and bringing musicians together around the gear they love.`,
    tech: [
      { icon: "bx bxl-javascript", name: "JavaScript" },
      { icon: "bx bxl-nodejs", name: "NodeJS" },
      { icon: "bx bxl-mongodb", name: "MongoDB" },
      { icon: "bx bxl-react", name: "React" },
      { icon: "bx bxl-tailwind-css", name: "Tailwind CSS" },
      { icon: "bx bxl-html5", name: "HTML5" },
      { icon: "bx bxl-git", name: "Git" },
      { icon: "bx bxl-visual-studio", name: "VSCode" }
    ]
  },
    {
    title: "Simple Weight Loss Tracker",
    images: [
      "/assets/img/weightloss.png"
    ],
    site: "http://www.simpleweightlosstracker.co.uk",
    description: `I'm currently on a **weight loss journey** so I wrote this to keep track of my progress.<br><br>
    There are plenty of weight loss trackers out there, but I wanted to build one that was **private and ad free**.<br><br>

The app is built with **plain JavaScript and Chart.js**. I chose to build inside Astro.js for convenience as it already has routing and markdown support built-in.`,
    tech: [
      { icon: "bx bxl-javascript", name: "JavaScript" },
      { icon: "bx bxl-html5", name: "HTML5" },
      { icon: "bx bxl-git", name: "Git" },
      { icon: "bx bxl-visual-studio", name: "VSCode" }
    ]
  },
  {
    title: "whatsthescore",
    images: [
      "/assets/img/whatsthescore2025.png"
    ],
    site: "https://whatsthescore.netlify.app/",
    source: "https://github.com/tabrezakhtar/whatsthescore-web",
    description: `I built this app as a way of keeping the score during a **tennis match**. <br><br>
    Sometimes during a long match, it's easy to forget! The UI is designed to be as **simple as possible**, with only 2 buttons to control the score.<br><br>
To build this project, I used **React with the Context API** and styled it using BeerCSS for a Material theme. <br><br>
The module to model the tennis score is built with a **Test-Driven approach using Jest**, since tennis scoring has a lot of edge cases that can easily slip through without tests.`,
    tech: [
      { icon: "bx bxl-javascript", name: "JavaScript" },
      { icon: "bx bxl-react", name: "React" },
      { icon: "bx bxl-html5", name: "HTML5" },
      { icon: "bx bxl-git", name: "Git" },
      { icon: "bx bxl-visual-studio", name: "VSCode" }
    ]
  }
];
---
<section id="projects" class="projects section-bg">
  <div class="container">
    <div class="section-title">
      <h2>My Projects</h2>
      <p>
        Here are some personal projects that I am working on now. I've tried to
        combine some of my other interests with coding.
      </p>
    </div>
    {projects.map(project => (
      <div class="row" data-aos="fade-up" data-aos-delay="100">
        <div class="project__container">
          <div class="lhs">
            {project.images.map((img, imgIndex) => (
              <img 
                src={img} 
                alt={`Screenshot of ${project.title}`} 
                data-bs-toggle="modal" 
                data-bs-target={`#projectModal${projects.indexOf(project)}${imgIndex}`}
              />
            ))}
          </div>
          <div class="rhs">
            <span>
              <a class="link h4" href={project.site} target="_blank" rel="noopener noreferrer">{project.title}</a>
            </span>
            <div class="project-description" set:html={marked(project.description)} />
            <div class="tech__badges">
              {project.tech.map(t => (
                <div data-aos="flip-left">
                  <i class={t.icon}></i>
                  <span>{t.name}</span>
                </div>
              ))}
            </div>
            <p>
              {project.source && (
                <span>
                  source: <a class="link" href={project.source} target="_blank" rel="noopener noreferrer">{project.source}</a>
                </span>
              )}
              {project.site && (
                <span>
                  site: <a class="link" href={project.site} target="_blank" rel="noopener noreferrer">{project.site}</a>
                </span>
              )}
            </p>
          </div>
        </div>
      </div>
    ))}
  </div>
</section>

<!-- Bootstrap Modals for Lightbox -->
{projects.map((project, index) => (
  project.images.map((img, imgIndex) => (
    <div
      class="modal fade"
      id={`projectModal${index}${imgIndex}`}
      tabindex="-1"
      aria-labelledby={`projectModalLabel${index}${imgIndex}`}
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id={`projectModalLabel${index}${imgIndex}`}>{project.title}</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body text-center">
            <img 
              src={img} 
              alt={`Screenshot of ${project.title}`} 
              class="img-fluid" 
              data-bs-dismiss="modal"
              style="cursor: pointer;"
            />
          </div>
        </div>
      </div>
    </div>
  ))
))}

<style>
  .project__container {
    display: flex;
    border-bottom: 1px solid $divider-color;
  }

  @media (max-width: 720px) {
    .project__container {
      display: block;
    }
  }


  .project__container .lhs {
    flex: 0 1 calc(30%);
    display: flex;
    justify-content: center;
    align-items: top;
    flex-direction: column;
  }

  @media (max-width: 720px) {
    .project__container .lhs {
      align-items: center;
    }
  }

  .project__container .lhs img {
    transition: all .2s ease-in-out;
    width: 24rem;
    padding-top: 2rem;
  }

  @media (max-width: 720px) {
    .project__container .lhs img {
      width: 35rem;
    }  
  }

  .project__container .lhs img:hover {
    transform: scale(1.1);
    cursor: pointer;
  }

  .project__container .rhs {
    justify-content: center;
    flex: 1;
    padding: 2rem;
  }

  .project__container .rhs span {
    display: block;
    padding-bottom: 1rem;
  }

  .project__container .rhs p {
    padding-bottom: 1rem;
  }

  .project-description p {
    margin-bottom: 1rem;
  }

  .project-description ul {
    margin: 1rem 0;
    padding-left: 2rem;
    list-style-type: disc;
  }

  .project-description li {
    margin-bottom: 0.5rem;
    display: list-item;
    list-style-type: disc;
    list-style-position: outside;
  }

  .project-description strong {
    font-weight: bold;
  }

  .project__container .rhs .tech__badges {
    justify-content: left;
    padding-top: 1.5rem;
  }

  .project__container .rhs .tech__badges img {
    width: 3rem;
  }

  .link {
    font-weight: bold;
    color: #008080;
    text-decoration: underline;
  }

  .modal-body img {
    max-height: 70vh;
    width: auto;
    max-width: 100%;
    object-fit: contain;
    display: block;
    margin: 0 auto;
  }
</style>
